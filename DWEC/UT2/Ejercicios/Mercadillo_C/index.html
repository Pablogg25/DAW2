<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Mercadillo - Gesti√≥n de Inventario</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }

        h1 {
            text-align: center;
        }

        form {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px #ccc;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        input,
        select {
            padding: 5px;
            margin-top: 5px;
            width: 200px;
        }

        button {
            margin-top: 10px;
            padding: 5px 10px;
        }

        #resultado {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px #ccc;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #007BFF;
            color: white;
        }
    </style>
</head>

<body>
    <h1>üõí Mercadillo - Gesti√≥n de Inventario</h1>

    <form id="formProductos">
        <h2>Gesti√≥n de Productos</h2>

        <label>Nombre: <input type="text" id="nombre"></label>
        <label>Cantidad: <input type="number" id="cantidad"></label>
        <label>Precio: <input type="number" step="0.01" id="precio"></label>
        <label>Categor√≠a: <input type="text" id="categoria"></label>

        <button type="button" id="btnAgregar">Agregar</button>
        <button type="button" id="btnEliminar">Eliminar</button>
        <button type="button" id="btnBuscar">Buscar</button>
        <button type="button" id="btnActualizar">Actualizar Stock</button>
        <button type="button" id="btnOrdenar">Ordenar por Precio</button>
        <button type="button" id="btnFiltrar">Filtrar por Categor√≠a</button>
        <button type="button" id="btnMostrar">Mostrar Inventario</button>
    </form>

    <div id="resultado">
        <h2>Resultado:</h2>
        <div id="salida">Sin datos...</div>
    </div>

    <script>
        // ==========================
        // M√ìDULO DE NEGOCIO
        // ==========================
        const $negocio = (function () {
            let inventario = {};

            function agregarProducto(nombre, cantidad, precio, categoria) {
                if (inventario[nombre]) {
                    alert("El producto '" + nombre + "' ya existe.");
                    return;
                }
                inventario[nombre] = {
                    cantidad: Number(cantidad),
                    precio: Number(precio),
                    categoria: categoria
                };
            }

            function eliminarProducto(nombre) {
                if (!inventario[nombre]) {
                    alert("El producto '" + nombre + "' no existe.");
                    return;
                }
                delete inventario[nombre];
            }

            function buscarProducto(nombre) {
                return inventario[nombre] || null;
            }

            function actualizarInventario(nombre, cantidad) {
                if (!inventario[nombre]) {
                    alert("El producto '" + nombre + "' no existe.");
                    return;
                }
                inventario[nombre].cantidad += Number(cantidad);
                if (inventario[nombre].cantidad <= 0) {
                    inventario[nombre].cantidad = 0;
                    alert("¬°Stock agotado! Reponer '" + nombre + "'.");
                }
            }

            function ordenarProductosPorPrecio() {
                return Object.entries(inventario)
                    .sort((a, b) => a[1].precio - b[1].precio)
                    .map(([nombre, datos]) => ({ nombre, ...datos }));
            }

            function imprimirInventario() {
                let lista = [];
                for (let nombre in inventario) {
                    let p = inventario[nombre];
                    lista.push({
                        nombre: nombre,
                        categoria: p.categoria,
                        cantidad: p.cantidad,
                        precio: p.precio,
                        total: p.cantidad * p.precio
                    });
                }
                return lista;
            }

            function filtrarProductosPorCategoria(categoria) {
                let lista = [];
                for (let nombre in inventario) {
                    let p = inventario[nombre];
                    if (p.categoria === categoria) {
                        lista.push({
                            nombre: nombre,
                            cantidad: p.cantidad,
                            precio: p.precio
                        });
                    }
                }
                return lista;
            }

            return {
                agregarProducto,
                eliminarProducto,
                buscarProducto,
                actualizarInventario,
                ordenarProductosPorPrecio,
                imprimirInventario,
                filtrarProductosPorCategoria
            };
        })();

        // ==========================
        // INTERFAZ HTML
        // ==========================
        window.addEventListener("load", () => {
            const salida = document.getElementById("salida");

            function mostrarTabla(datos) {
                if (!datos || datos.length === 0) {
                    salida.innerHTML = "<p>No hay datos para mostrar.</p>";
                    return;
                }

                let html = "<table><tr>";
                for (let clave in datos[0]) {
                    html += "<th>" + clave + "</th>";
                }
                html += "</tr>";

                datos.forEach(obj => {
                    html += "<tr>";
                    for (let clave in obj) {
                        html += "<td>" + obj[clave] + "</td>";
                    }
                    html += "</tr>";
                });
                html += "</table>";
                salida.innerHTML = html;
            }

            document.getElementById("btnAgregar").addEventListener("click", () => {
                const n = nombre.value.trim();
                if (n === "") return alert("Introduce un nombre de producto");
                $negocio.agregarProducto(n, cantidad.value, precio.value, categoria.value);
                mostrarTabla($negocio.imprimirInventario());
            });

            document.getElementById("btnEliminar").addEventListener("click", () => {
                const n = nombre.value.trim();
                if (n === "") return alert("Introduce un nombre");
                if (confirm("¬øSeguro que quieres eliminar '" + n + "'?")) {
                    $negocio.eliminarProducto(n);
                    mostrarTabla($negocio.imprimirInventario());
                }
            });

            document.getElementById("btnBuscar").addEventListener("click", () => {
                const n = nombre.value.trim();
                let prod = $negocio.buscarProducto(n);
                if (!prod) salida.innerHTML = "<p>No existe el producto.</p>";
                else mostrarTabla([{ nombre: n, ...prod }]);
            });

            document.getElementById("btnActualizar").addEventListener("click", () => {
                const n = nombre.value.trim();
                const c = Number(cantidad.value);
                if (n === "" || isNaN(c)) return alert("Introduce nombre y cantidad v√°lida");
                $negocio.actualizarInventario(n, c);
                mostrarTabla($negocio.imprimirInventario());
            });

            document.getElementById("btnOrdenar").addEventListener("click", () => {
                mostrarTabla($negocio.ordenarProductosPorPrecio());
            });

            document.getElementById("btnFiltrar").addEventListener("click", () => {
                const cat = categoria.value.trim();
                mostrarTabla($negocio.filtrarProductosPorCategoria(cat));
            });

            document.getElementById("btnMostrar").addEventListener("click", () => {
                mostrarTabla($negocio.imprimirInventario());
            });
        });
    </script>
</body>

</html>